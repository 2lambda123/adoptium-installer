# Maintainer: Eclipse Adoptium Package Maintainers <temurin-dev@eclipse.org>
pkgname=temurin-8-jdk
pkgver=8.422.05
pkgrel=0
pkgdesc="Eclipse Temurin 8 (JDK)"
provider_priority=8
url="https://adoptium.net"
arch="x86_64"
license="GPL-2.0-with-classpath-exception"
makedepends="
	alsa-lib-dev
	libpng-dev
	libxcomposite-dev
	libxinerama-dev
	libxslt
	libxrender-dev
	libxt-dev
	libxtst-dev
"
depends="
	java-common
	java-cacerts
	ttf-dejavu
"
source="
	https://github.com/adoptium/temurin8-binaries/releases/download/jdk8u422-b05/OpenJDK8U-jdk_${CARCH/x86_64/x64}_alpine-linux_hotspot_8u422b05.tar.gz

	HelloWorld.java
	
"

_java_home="/usr/lib/jvm/java-8-temurin"

# Exclude xawt from ldpath to avoid duplicate provides for libmawt.so
# (also in headless). in future this should be a virtual provides.
ldpath="$_jrelib:$_jrelib/native_threads:$_jrelib/headless:$_jrelib/server:$_jrelib/jli"
sonameprefix="$pkgname:"

prepare() {
	default_prepare
}

check() {
	local _java_bin="./jdk8u422-b05/bin"

	# 1) compile and run a simple hello world
	$_java_bin/javac -d . "$srcdir"/HelloWorld.java
	$_java_bin/java HelloWorld

	
	# 2) check that java -version and javac -version work
	$_java_bin/java -version
	$_java_bin/javac -version
}

package() {
	provides=java-jdk
	mkdir -p "$pkgdir/$_java_home"
	cp -r "$srcdir"/jdk8u422-b05/* "$pkgdir/$_java_home"
	rm "$pkgdir"/$_java_home/src.zip
	
	# symlink to shared java cacerts store
	rm -f "$pkgdir"/$_java_home/jre/lib/security/cacerts
	ln -sf /etc/ssl/certs/java/cacerts \
		"$pkgdir"/$_java_home/jre/lib/security/cacerts
}



case "$CARCH" in
	x86_64)
		_arch_sum="525a7731331cad502b9293ccb4ac2b13e85516736e98a57cb27c2767005188e1"
		;;
esac

sha256sums="
$_arch_sum  OpenJDK8U-jdk_${CARCH/x86_64/x64}_alpine-linux_hotspot_8u422b05.tar.gz
e9185736dde99a4dc570a645a20407bdb41c1f48dfc34d9c3eb246cf0435a378  HelloWorld.java
"
